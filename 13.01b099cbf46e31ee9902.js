(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{IFz3:function(t,e,o){"use strict";o.r(e),o.d(e,"PlaygroundWorkflowsFeatureDetailsModule",function(){return K});var i=o("ofXK"),n=o("3Pt+"),r=o("tyNb"),l=o("xHha"),s=o("WeE/"),c=o("OJFL"),a=o("nDrI"),d=o("rfrl"),u=o("lkzG"),p=o("twkR"),f=o("ufcJ"),g=o("hDJq"),b=o("eIep"),h=o("zp1y"),w=o("lJxs"),v=o("vkgz"),k=o("wO+i"),m=o("fXoL");let y=(()=>{class t extends g.a{constructor(t,e){super({saving:!1,workflow:{data:null,status:"idle",error:""},groupNodes:new Map,conditionNodes:new Map,currentLevels:new Set}),this.service=t,this.workflow$=this.select(t=>t.workflow),this.maxDepth$=this.select(this.workflow$,t=>{var e;return(null===(e=t.data)||void 0===e?void 0:e.maxDepth)||2}),this.groupNodes$=this.select(t=>t.groupNodes),this.conditionNodes$=this.select(t=>t.conditionNodes),this.vm$=this.select(this.state$,({workflow:{data:t,status:e},groupNodes:o,currentLevels:i})=>{var n;return{workflow:t,loading:"loading"===e,root:null===(n=o.values().next().value)||void 0===n?void 0:n.id,currentMaxLevel:Math.max(...i.values())}}),this.initializeEffect=this.effect(t=>t.pipe(Object(b.a)(t=>this.service.item(t).pipe(Object(f.b)(t=>{if("loading"===t.status)this.patchState({workflow:t});else{const{groupNodes:e,conditionNodes:o}=p.a.normalize(t.data.group);this.patchState({saving:!1,workflow:t,groupNodes:e,conditionNodes:o,currentLevels:new Set([...e.values()].map(t=>t.level))})}},console.error))))),this.addGroup=this.updater((t,{parentId:e,level:o})=>{var i;const n=Object(p.b)();t.groupNodes.set(n,{id:n,parentId:e,type:u.a.group,children:[],level:o+1}),null===(i=t.groupNodes.get(e))||void 0===i||i.children.push({id:n,type:u.a.group}),t.currentLevels.add(o+1)}),this.addCondition=this.updater((t,e)=>{var o;const i=Object(p.b)();t.conditionNodes.set(i,{id:i,parentId:e,type:u.a.condition,value:!1}),null===(o=t.groupNodes.get(e))||void 0===o||o.children.push({id:i,type:u.a.condition})}),this.removeGroup=this.updater((t,e)=>{var o,i;const n=t.groupNodes.get(e);p.a.deleteGroupRecursive(t.groupNodes,t.conditionNodes,n);const r=t.groupNodes.get(n.parentId);r.children=null!==(i=null===(o=r.children)||void 0===o?void 0:o.filter(t=>t.id!==e))&&void 0!==i?i:[],![...t.groupNodes.values()].some(t=>t.level===n.level)&&t.currentLevels.delete(n.level)}),this.removeCondition=this.updater((t,e)=>{var o,i;const n=t.conditionNodes.get(e);t.conditionNodes.delete(e);const r=t.groupNodes.get(n.parentId);r.children=null!==(i=null===(o=r.children)||void 0===o?void 0:o.filter(t=>t.id!==e))&&void 0!==i?i:[]}),this.updateCondition=this.updater((t,e)=>{t.conditionNodes.has(e.id)&&t.conditionNodes.set(e.id,e)}),this.saveWorkflowEffect=this.effect(t=>t.pipe(Object(h.a)(this.groupNodes$,this.conditionNodes$,this.workflow$),Object(w.a)(([{workflowName:t,maxDepth:e},o,i,{data:n}])=>{const r=p.a.denormalize(o,i);return Object.assign(Object.assign({},n),{maxDepth:e,name:t,group:r})}),Object(b.a)(t=>this.service.update(t.id,t).pipe(Object(v.a)(t=>{this.patchState(e=>({workflow:Object.assign(Object.assign({},e.workflow),{data:t})}))}))))),this.initializeEffect(e.params.pipe(Object(k.a)("workflowId")))}}return t.\u0275fac=function(e){return new(e||t)(m.Ub(u.b),m.Ub(r.a))},t.\u0275prov=m.Gb({token:t,factory:t.\u0275fac}),t})(),x=(()=>{class t extends g.a{constructor(t){super(),this.workflowDetailStore=t,this.groupId$=this.select(t=>t.groupId),this.group$=this.select(this.groupId$,this.workflowDetailStore.groupNodes$,(t,e)=>e.get(t)),this.vm$=this.select(this.state$,this.group$,this.workflowDetailStore.maxDepth$,({level:t,isCollapsed:e},o,i)=>{var n;return{level:t,group:o,isCollapsed:e,isAtMaxDepth:t===i,isSubGroup:t>0,hasNoChildren:!(null===(n=null==o?void 0:o.children)||void 0===n?void 0:n.length),nextLevel:t+1,collapsedIcon:e?"plusCircle":"minusCircle"}}),this.toggleCollapse=this.updater(t=>{t.isCollapsed=!t.isCollapsed}),this.addGroupEffect=this.effect(t=>t.pipe(Object(h.a)(this.groupId$,this.select(t=>t.level)),Object(v.a)(([,t,e])=>this.workflowDetailStore.addGroup({parentId:t,level:e})))),this.addConditionEffect=this.effect(t=>t.pipe(Object(h.a)(this.groupId$),Object(v.a)(([,t])=>this.workflowDetailStore.addCondition(t)))),this.removeEffect=this.effect(t=>t.pipe(Object(h.a)(this.group$),Object(v.a)(([,t])=>{var e,o;const i=null==t?void 0:t.id;(!(null===(e=null==t?void 0:t.children)||void 0===e?void 0:e.length)||(null===(o=null==t?void 0:t.children)||void 0===o?void 0:o.length)&&confirm("Removing a group will remove all of its children?"))&&this.workflowDetailStore.removeGroup(i)})))}setGroup(t,e){this.setState({groupId:t,level:e,isCollapsed:!1})}}return t.\u0275fac=function(e){return new(e||t)(m.Ub(y))},t.\u0275prov=m.Gb({token:t,factory:t.\u0275fac}),t})(),I=(()=>{class t extends g.a{constructor(t){super(),this.workflowDetailStore=t,this.conditionId$=this.select(t=>t.conditionId),this.condition$=this.select(this.conditionId$,this.workflowDetailStore.conditionNodes$,(t,e)=>e.get(t)),this.vm$=this.select(this.condition$,t=>({condition:t})),this.deleteConditionEffect=this.effect(t=>t.pipe(Object(h.a)(this.conditionId$),Object(v.a)(([,t])=>{this.workflowDetailStore.removeCondition(t)}))),this.updateConditionEffect=this.effect(t=>t.pipe(Object(h.a)(this.condition$),Object(v.a)(([t,e])=>{this.workflowDetailStore.updateCondition(Object.assign(Object.assign({},e),{value:t}))})))}setConditionId(t){this.setState({conditionId:t})}}return t.\u0275fac=function(e){return new(e||t)(m.Ub(y))},t.\u0275prov=m.Gb({token:t,factory:t.\u0275fac}),t})();var C=o("KG2P"),N=o("Gqot"),O=o("qvdW"),D=o("Czul");function $(t,e){if(1&t){const t=m.Rb();m.Qb(0,"button",8),m.Xb("click",function(){return m.mc(t),m.ac(2).deleteCondition()}),m.Lb(1,"playground-icon",9),m.Pb()}}function S(t,e){if(1&t&&(m.Ob(0),m.Qb(1,"div",1),m.Qb(2,"h2",2),m.Qb(3,"span",3),m.uc(4),m.Pb(),m.sc(5,$,2,0,"button",4),m.Pb(),m.Qb(6,"div",5),m.Qb(7,"label",6),m.Lb(8,"input",7),m.uc(9," Allow delete this condition "),m.Pb(),m.Pb(),m.Pb(),m.Nb()),2&t){const t=e.ngIf,o=m.ac();m.zb(4),m.wc("Condition: ",null==t.condition?null:t.condition.id,""),m.zb(1),m.gc("ngIf",null==t.condition?null:t.condition.value),m.zb(2),m.gc("for","allowDeleteControl"+o.conditionId),m.zb(1),m.gc("id","allowDeleteControl"+o.conditionId)("formControl",o.allowDeleteControl)}}let j=(()=>{class t{constructor(t){this.workflowConditionStore=t,this.allowDeleteControl=new n.e,this.vm$=this.workflowConditionStore.vm$.pipe(Object(v.a)(({condition:t})=>{this.setupAllowDeleteControl(null==t?void 0:t.value)}))}ngOnInit(){this.workflowConditionStore.setConditionId(this.conditionId),this.workflowConditionStore.updateConditionEffect(this.allowDeleteControl.valueChanges)}deleteCondition(){this.workflowConditionStore.deleteConditionEffect()}setupAllowDeleteControl(t){null==this.allowDeleteControl.value&&this.allowDeleteControl.setValue(t,{onlySelf:!0,emitEvent:!1})}}return t.\u0275fac=function(e){return new(e||t)(m.Kb(I))},t.\u0275cmp=m.Eb({type:t,selectors:[["playground-workflow-condition"]],inputs:{conditionId:"conditionId"},features:[m.yb([I])],decls:2,vars:3,consts:[[4,"ngIf"],[1,"ml-6","border","border-gray-400","dark:border-gray-600","mb-2"],[1,"py-2","px-3","dark:bg-gray-600","dark:text-gray-300","bg-gray-200","text-gray-900","dark:text-gray-100","flex","justify-between","items-center"],[1,"block"],["class","text-gray-700 dark:text-gray-300",3,"click",4,"ngIf"],[1,"p-3"],[3,"for"],["type","checkbox",3,"id","formControl"],[1,"text-gray-700","dark:text-gray-300",3,"click"],["icon","trash","size","sm"]],template:function(t,e){1&t&&(m.sc(0,S,10,5,"ng-container",0),m.bc(1,"async")),2&t&&m.gc("ngIf",m.cc(1,1,e.vm$))},directives:[i.l,n.b,n.i,n.f,D.a],pipes:[i.b],styles:["[_nghost-%COMP%] {\n        display: block;\n      }"],changeDetection:0}),t})();function z(t,e){if(1&t){const t=m.Rb();m.Qb(0,"button",14),m.Xb("click",function(){return m.mc(t),m.ac(2).deleteGroup()}),m.Lb(1,"playground-icon",15),m.Pb()}}function G(t,e){1&t&&(m.Qb(0,"div",16),m.uc(1,"No conditions or groups"),m.Pb())}function P(t,e){if(1&t&&m.Lb(0,"playground-workflow-condition",19),2&t){const t=m.ac().$implicit;m.gc("conditionId",t.id)}}function L(t,e){if(1&t&&m.Lb(0,"playground-workflow-group",20),2&t){const t=m.ac().$implicit,e=m.ac().ngIf;m.gc("groupId",t.id)("level",e.nextLevel)}}function Q(t,e){if(1&t&&(m.Ob(0),m.sc(1,P,1,1,"playground-workflow-condition",17),m.sc(2,L,1,2,"playground-workflow-group",18),m.Nb()),2&t){const t=e.$implicit,o=m.ac(2);m.zb(1),m.gc("ngIf",t.type===o.type.condition),m.zb(1),m.gc("ngIf",t.type===o.type.group)}}function E(t,e){if(1&t){const t=m.Rb();m.Qb(0,"button",12),m.Xb("click",function(){return m.mc(t),m.ac(2).addGroup()}),m.Lb(1,"playground-icon",13),m.Qb(2,"span"),m.uc(3,"Group"),m.Pb(),m.Pb()}}function M(t,e){if(1&t){const t=m.Rb();m.Ob(0),m.Qb(1,"div",1),m.Qb(2,"h2",2),m.Qb(3,"span",3),m.Qb(4,"button",4),m.Xb("click",function(){return m.mc(t),m.ac().toggleCollapse()}),m.Lb(5,"playground-icon",5),m.Pb(),m.uc(6),m.Pb(),m.sc(7,z,2,0,"button",6),m.Pb(),m.Qb(8,"div",7),m.sc(9,G,2,0,"div",8),m.sc(10,Q,3,2,"ng-container",9),m.Qb(11,"div",10),m.sc(12,E,4,0,"button",11),m.Qb(13,"button",12),m.Xb("click",function(){return m.mc(t),m.ac().addCondition()}),m.Lb(14,"playground-icon",13),m.Qb(15,"span"),m.uc(16,"Condition"),m.Pb(),m.Pb(),m.Pb(),m.Pb(),m.Pb(),m.Nb()}if(2&t){const t=e.ngIf;m.zb(1),m.Cb("ml-6",t.isSubGroup),m.zb(4),m.gc("icon",t.collapsedIcon),m.zb(1),m.wc(" Group: ",null==t.group?null:t.group.id," "),m.zb(1),m.gc("ngIf",t.isSubGroup),m.zb(1),m.Cb("block",!t.isCollapsed)("hidden",t.isCollapsed),m.zb(1),m.gc("ngIf",t.hasNoChildren),m.zb(1),m.gc("ngForOf",null==t.group?null:t.group.children),m.zb(2),m.gc("ngIf",!t.isAtMaxDepth)}}let R=(()=>{class t{constructor(t){this.workflowGroupStore=t,this.level=0,this.type=u.a,this.vm$=this.workflowGroupStore.vm$}ngOnInit(){this.workflowGroupStore.setGroup(this.groupId,this.level)}addGroup(){this.workflowGroupStore.addGroupEffect()}addCondition(){this.workflowGroupStore.addConditionEffect()}deleteGroup(){this.workflowGroupStore.removeEffect()}toggleCollapse(){this.workflowGroupStore.toggleCollapse()}}return t.\u0275fac=function(e){return new(e||t)(m.Kb(x))},t.\u0275cmp=m.Eb({type:t,selectors:[["playground-workflow-group"]],inputs:{groupId:"groupId",level:"level"},features:[m.yb([x])],decls:2,vars:3,consts:[[4,"ngIf"],[1,"border","border-gray-400","dark:border-gray-600","mb-3"],[1,"py-2","px-2","dark:bg-gray-700","dark:text-gray-300","bg-gray-400","text-gray-900","dark:text-gray-100","flex","justify-between"],[1,"flex","items-center"],[1,"text-gray-700","dark:text-gray-300","mr-2",3,"click"],[3,"icon"],["class","text-gray-700 dark:text-gray-300",3,"click",4,"ngIf"],[1,"p-3"],["class","text-gray-700 dark:text-gray-300 ml-8 text-sm",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"ml-6","mt-2","flex","items-center","space-x-2"],["class","text-gray-600 bg-gray-200 dark:text-gray-300 dark:bg-gray-700 px-2 py-1 flex items-center space-x-2",3,"click",4,"ngIf"],[1,"text-gray-600","bg-gray-200","dark:text-gray-300","dark:bg-gray-700","px-2","py-1","flex","items-center","space-x-2",3,"click"],["icon","plusCircle"],[1,"text-gray-700","dark:text-gray-300",3,"click"],["icon","trash","size","sm"],[1,"text-gray-700","dark:text-gray-300","ml-8","text-sm"],[3,"conditionId",4,"ngIf"],[3,"groupId","level",4,"ngIf"],[3,"conditionId"],[3,"groupId","level"]],template:function(t,e){1&t&&(m.sc(0,M,17,12,"ng-container",0),m.bc(1,"async")),2&t&&m.gc("ngIf",m.cc(1,1,e.vm$))},directives:[i.l,D.a,i.k,j,t],pipes:[i.b],styles:["[_nghost-%COMP%] {\n        display: block;\n      }"],changeDetection:0}),t})();function W(t,e){1&t&&(m.Ob(0),m.uc(1," No workflow group!"),m.Nb())}function X(t,e){if(1&t&&(m.Ob(0),m.Lb(1,"playground-workflow-group",8),m.Nb()),2&t){const t=m.ac().ngIf;m.zb(1),m.gc("groupId",t.root)}}const F=function(t,e,o){return{workflowName:t,maxDepth:e,currentMaxLevel:o}};function J(t,e){if(1&t){const t=m.Rb();m.Ob(0),m.Qb(1,"playground-page"),m.Qb(2,"div",1),m.Qb(3,"div",2),m.Qb(4,"div",3),m.Lb(5,"playground-form",4),m.Pb(),m.Pb(),m.Qb(6,"button",5),m.Xb("click",function(){return m.mc(t),m.ac().saveWorkflow()}),m.uc(7," Save "),m.Pb(),m.Qb(8,"div",6),m.Lb(9,"playground-loading",7),m.sc(10,W,2,0,"ng-container",0),m.sc(11,X,2,1,"ng-container",0),m.Pb(),m.Pb(),m.Pb(),m.Nb()}if(2&t){const t=e.ngIf,o=m.ac();m.zb(5),m.gc("form",o.form)("fields",o.fields)("model",m.jc(7,F,null==t.workflow?null:t.workflow.name,null==t.workflow?null:t.workflow.maxDepth,t.currentMaxLevel||0)),m.zb(1),m.gc("disabled",o.form.invalid),m.zb(3),m.gc("loading",t.loading),m.zb(1),m.gc("ngIf",!(null!=t.workflow&&t.workflow.group)),m.zb(1),m.gc("ngIf",null==t.workflow?null:t.workflow.group)}}let A=(()=>{class t{constructor(t){this.workflowDetailStore=t,this.vm$=this.workflowDetailStore.vm$,this.form=new n.g({}),this.fields=[l.a.fieldRow([l.a.input("workflowName",{label:"Workflow Name"},{className:"col-span-3"}),l.a.number("maxDepth",{label:"Max Depth"},{expressionProperties:{"templateOptions.min":"model.currentMaxLevel"}})],"grid grid-cols-4 gap-4")]}saveWorkflow(){this.workflowDetailStore.saveWorkflowEffect({workflowName:this.form.value.workflowName,maxDepth:Number(this.form.value.maxDepth)})}}return t.\u0275fac=function(e){return new(e||t)(m.Kb(y))},t.\u0275cmp=m.Eb({type:t,selectors:[["playground-workflow-details"]],features:[m.yb([y])],decls:2,vars:3,consts:[[4,"ngIf"],[1,"bg-white","dark:bg-gray-800","text-gray-900","dark:text-gray-200","shadow-lg","rounded-lg","overflow-hidden","py-4","px-6"],[1,"flex-grow","flex","justify-between","gap-4"],[1,"flex","flex-grow","items-center"],[1,"w-full",3,"form","fields","model"],[1,"bg-green-400","hover:bg-green-500","text-white","py-1","px-2","rounded","disabled:opacity-50","disabled:cursor-not-allowed","disabled:pointer-events-none",3,"disabled","click"],[1,"w-full","mt-6"],[3,"loading"],[3,"groupId"]],template:function(t,e){1&t&&(m.sc(0,J,12,11,"ng-container",0),m.bc(1,"async")),2&t&&m.gc("ngIf",m.cc(1,1,e.vm$))},directives:[i.l,C.a,N.a,O.a,R],pipes:[i.b],styles:["[_nghost-%COMP%] {\n        display: block;\n      }"],changeDetection:0}),t})();Object(d.a)();let K=(()=>{class t{}return t.\u0275mod=m.Ib({type:t}),t.\u0275inj=m.Hb({factory:function(e){return new(e||t)},imports:[[i.c,r.e.forChild([{path:"",component:A}]),a.a,c.a,s.a,n.m,l.b]]}),t})()}}]);